<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioLab: Blood Compatibility Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f8fafc; 
            color: #1e293b;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .main-panel {
            background: white;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .blood-card {
            transition: all 0.2s ease;
            border: 2px solid #f1f5f9;
            background: white;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .blood-card:hover {
            background: #fff1f2;
            border-color: #fecaca;
        }

        .blood-card.active {
            background: #ef4444;
            border-color: #dc2626;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.3);
        }

        .comp-box {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.25rem;
            height: 60px;
            border-width: 2px;
        }

        .matrix-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* DEFAULT STATE (Inactive Columns) */
        .dot-incompatible-base {
            background-color: #fee2e2 !important; /* Very Light Red 100 */
        }

        .dot-compatible-base {
            background-color: #f1f5f9 !important; /* Very Light Slate 100 */
        }

        /* ACTIVE STATE (Selected Column) */
        .dot-incompatible-active {
            background-color: #b91c1c !important; /* Deep Red 700 */
        }

        .dot-compatible-active {
            background-color: #10b981 !important; /* Emerald 500 */
        }

        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .section-title {
            font-size: 0.9rem;
            letter-spacing: 0.05em;
            font-weight: 800;
            color: #64748b;
        }

        thead th {
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <nav class="border-b border-slate-200 px-8 py-5 flex justify-between items-center bg-white">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center font-bold text-white text-xl shadow-md">B+</div>
            <div>
                <h1 class="text-2xl font-extrabold tracking-tight text-slate-900">BIOLAB <span class="text-red-600 font-medium">CONSOLE</span></h1>
                <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Medical Grade Serology Interface</p>
            </div>
        </div>
        <div class="hidden md:flex gap-6 text-sm font-bold uppercase tracking-wider">
            <div class="flex items-center gap-2 text-slate-500"><span class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></span> Analyzing Interactive Matrix</div>
        </div>
    </nav>

    <main class="flex-grow grid grid-cols-1 lg:grid-cols-12 overflow-hidden">
        <aside class="lg:col-span-2 border-r border-slate-200 p-6 bg-slate-50 overflow-y-auto">
            <p class="section-title uppercase mb-6">Patient Sample</p>
            <div class="grid grid-cols-1 gap-3" id="bloodGrid"></div>
        </aside>

        <section class="lg:col-span-10 p-8 flex flex-col gap-8 overflow-y-auto">
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                <!-- Donor Results -->
                <div class="main-panel rounded-3xl p-8 border-t-8 border-t-emerald-500">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h3 class="text-2xl font-black text-slate-800 uppercase italic">Can Donate To</h3>
                            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Outbound Safety</p>
                        </div>
                        <div class="w-12 h-12 bg-emerald-50 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
                        </div>
                    </div>
                    <div id="giveToGrid" class="grid grid-cols-4 gap-4"></div>
                    <div class="mt-8 p-5 bg-slate-50 rounded-2xl border border-slate-100">
                        <p class="text-sm text-slate-600 leading-relaxed font-medium">
                            <strong class="text-emerald-600 font-extrabold uppercase text-xs block mb-1">Donor Analysis:</strong> 
                            Type <span class="selected-text-name text-slate-900 font-black underline">...</span> contains <span id="antigenDetail" class="text-emerald-600 font-extrabold">...</span> antigens.
                        </p>
                    </div>
                </div>

                <!-- Recipient Results -->
                <div class="main-panel rounded-3xl p-8 border-t-8 border-t-sky-500">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h3 class="text-2xl font-black text-slate-800 uppercase italic">Can Receive From</h3>
                            <p class="text-sm text-slate-500 font-bold uppercase tracking-widest">Inbound Safety</p>
                        </div>
                        <div class="w-12 h-12 bg-sky-50 rounded-full flex items-center justify-center">
                            <svg class="w-6 h-6 text-sky-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                        </div>
                    </div>
                    <div id="receiveFromGrid" class="grid grid-cols-4 gap-4"></div>
                    <div class="mt-8 p-5 bg-slate-50 rounded-2xl border border-slate-100">
                        <p class="text-sm text-slate-600 leading-relaxed font-medium">
                            <strong class="text-sky-600 font-extrabold uppercase text-xs block mb-1">Immune Filter:</strong> 
                            This patient's plasma contains <span id="antibodyDetail" class="text-sky-600 font-extrabold">...</span> antibodies.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Global Matrix -->
            <div class="main-panel rounded-3xl p-8 mb-8">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-lg font-black text-slate-800 uppercase tracking-tighter">Compatibility Matrix</h3>
                    <div class="flex gap-6 text-xs font-bold uppercase text-slate-500">
                        <span class="flex items-center gap-2"><span class="w-3 h-3 bg-emerald-500 rounded-full"></span> Compatible</span>
                        <span class="flex items-center gap-2"><span class="w-3 h-3 bg-red-700 rounded-full"></span> Reaction Risk</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm mono border-separate border-spacing-2">
                        <thead>
                            <tr id="matrixHeader">
                                <th class="text-left text-slate-400 font-bold p-2">DONOR ⮕<br>RECPT ⬇</th>
                            </tr>
                        </thead>
                        <tbody id="matrixBody"></tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <script>
        const bloodData = {
            'O-': { give: ['O-', 'O+', 'A-', 'A+', 'B-', 'B+', 'AB-', 'AB+'], receive: ['O-'], antigens: 'no (zero)', antibodies: 'Anti-A, Anti-B, and Anti-Rh' },
            'O+': { give: ['O+', 'A+', 'B+', 'AB+'], receive: ['O-', 'O+'], antigens: 'Rh', antibodies: 'Anti-A and Anti-B' },
            'A-': { give: ['A-', 'A+', 'AB-', 'AB+'], receive: ['O-', 'A-'], antigens: 'A', antibodies: 'Anti-B and Anti-Rh' },
            'A+': { give: ['A+', 'AB+'], receive: ['O-', 'O+', 'A-', 'A+'], antigens: 'A and Rh', antibodies: 'Anti-B' },
            'B-': { give: ['B-', 'B+', 'AB-', 'AB+'], receive: ['O-', 'B-'], antigens: 'B', antibodies: 'Anti-A and Anti-Rh' },
            'B+': { give: ['B+', 'AB+'], receive: ['O-', 'O+', 'B-', 'B+'], antigens: 'B and Rh', antibodies: 'Anti-A' },
            'AB-': { give: ['AB-', 'AB+'], receive: ['O-', 'A-', 'B-', 'AB-'], antigens: 'A and B', antibodies: 'Anti-Rh' },
            'AB+': { give: ['AB+'], receive: ['O-', 'O+', 'A-', 'A+', 'B-', 'B+', 'AB-', 'AB+'], antigens: 'A, B, and Rh', antibodies: 'no' }
        };

        const types = Object.keys(bloodData);

        function init() {
            renderControls();
            renderMatrix();
            select('A+');
        }

        function renderControls() {
            const grid = document.getElementById('bloodGrid');
            types.forEach(type => {
                const btn = document.createElement('div');
                btn.className = 'blood-card py-4 px-5 rounded-2xl font-extrabold transition-all mb-2 flex justify-between items-center shadow-sm';
                btn.id = `btn-${safe(type)}`;
                btn.innerHTML = `<span>${type}</span> <span class="text-[10px] opacity-40 font-bold">TYPE</span>`;
                btn.onclick = () => select(type);
                grid.appendChild(btn);
            });
        }

        function select(type) {
            const data = bloodData[type];
            document.querySelectorAll('.blood-card').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${safe(type)}`).classList.add('active');

            document.querySelectorAll('.selected-text-name').forEach(el => el.innerText = type);
            document.getElementById('antigenDetail').innerText = data.antigens;
            document.getElementById('antibodyDetail').innerText = data.antibodies;

            updateCompDisplay('giveToGrid', data.give, 'bg-emerald-500 text-white border-emerald-600 shadow-lg shadow-emerald-200');
            updateCompDisplay('receiveFromGrid', data.receive, 'bg-sky-500 text-white border-sky-600 shadow-lg shadow-sky-200');

            updateMatrix(type);
        }

        function updateCompDisplay(id, list, classes) {
            const container = document.getElementById(id);
            container.innerHTML = '';
            types.forEach(t => {
                const isMatch = list.includes(t);
                const box = document.createElement('div');
                box.className = `comp-box border-2 transition-all duration-300 ${isMatch ? classes : 'bg-slate-50 border-slate-100 text-slate-300 opacity-40 scale-90'}`;
                box.innerText = t;
                container.appendChild(box);
            });
        }

        function renderMatrix() {
            const head = document.getElementById('matrixHeader');
            const body = document.getElementById('matrixBody');
            
            types.forEach(t => {
                const th = document.createElement('th');
                th.className = 'p-3 text-slate-400 font-black';
                th.innerText = t;
                head.appendChild(th);
            });

            types.forEach(recpt => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="font-black text-slate-700 pr-6 py-3 border-b border-slate-50">${recpt}</td>`;
                types.forEach(donor => {
                    const isOk = bloodData[donor].give.includes(recpt);
                    row.innerHTML += `
                        <td class="text-center p-0 border-b border-slate-50">
                            <div id="cell-${safe(donor)}-${safe(recpt)}" class="flex items-center justify-center h-12">
                                <div class="matrix-dot ${isOk ? 'dot-compatible-base' : 'dot-incompatible-base'}"></div>
                            </div>
                        </td>
                    `;
                });
                body.appendChild(row);
            });
        }

        function updateMatrix(selectedDonor) {
            const safeSel = safe(selectedDonor);
            
            // First, reset all dots across the entire table to base/light states
            document.querySelectorAll('.matrix-dot').forEach(d => {
                d.style.transform = 'scale(1)';
                d.style.boxShadow = 'none';
                
                // Determine if this cell is generally a compatible or incompatible cell
                const parentId = d.parentElement.id; // e.g., cell-Apos-Bneg
                const [_, donorPart, recptPart] = parentId.split('-');
                
                // We need to reverse the safe() to find the original keys
                const dKey = types.find(t => safe(t) === donorPart);
                const rKey = types.find(t => safe(t) === recptPart);
                const isOk = bloodData[dKey].give.includes(rKey);

                // Reset to BASE styles
                d.classList.remove('dot-compatible-active', 'dot-incompatible-active');
                d.classList.add(isOk ? 'dot-compatible-base' : 'dot-incompatible-base');
            });

            // Now, highlight only the column of the selected donor
            types.forEach(recpt => {
                const dot = document.querySelector(`#cell-${safeSel}-${safe(recpt)} .matrix-dot`);
                if (dot) {
                    dot.style.transform = 'scale(2.2)';
                    
                    const isOk = bloodData[selectedDonor].give.includes(recpt);
                    
                    if (isOk) {
                        dot.classList.remove('dot-compatible-base');
                        dot.classList.add('dot-compatible-active');
                        dot.style.boxShadow = '0 0 15px rgba(16, 185, 129, 0.4)';
                    } else {
                        dot.classList.remove('dot-incompatible-base');
                        dot.classList.add('dot-incompatible-active');
                        dot.style.boxShadow = '0 0 15px rgba(185, 28, 28, 0.4)';
                    }
                }
            });
        }

        function safe(str) { return str.replace('+', 'pos').replace('-', 'neg'); }

        window.onload = init;
    </script>
</body>
</html>
